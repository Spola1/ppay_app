{
  "openapi": "3.0.1",
  "info": {
    "title": "API V1",
    "description": "# ❗Авторизация\nДля выполнения на этой странице тестового запроса, требующего авторизацию (запрос с замочком), необходимо нажать кнопку `Authorize` и вставить туда ваш API-ключ.\n\n\n**Если вы разрабатываете интеграцию с нашим API, API-ключ нужно подставлять в header `Authorization`в формате `Bearer {Ваш API-ключ}`**",
    "version": "v1"
  },
  "paths": {
    "/api/v1/external_processing/payments/deposits": {
      "post": {
        "summary": "Создание депозита с внешним процессингом",
        "tags": [
          "Платежи с внешним процессингом"
        ],
        "security": [
          {
            "bearerAuth": {
            }
          }
        ],
        "parameters": [

        ],
        "responses": {
          "201": {
            "description": "успешное создание",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "id": "5054ec33-2ee6-4f50-beaf-3cf4686e4446",
                    "type": "Deposit",
                    "attributes": {
                      "uuid": "5054ec33-2ee6-4f50-beaf-3cf4686e4446",
                      "card_number": "1111111111111111",
                      "expiration_time": "2023-02-24T11:07:07.032+03:00"
                    }
                  }
                },
                "schema": {
                  "$ref": "#/components/schemas/external_processing_deposits_create_response_body_schema"
                }
              }
            }
          },
          "422": {
            "description": "invalid",
            "content": {
              "application/json": {
                "example": {
                  "errors": [
                    {
                      "title": "payment_system",
                      "detail": "не выбрана",
                      "code": 422
                    }
                  ]
                }
              }
            }
          },
          "401": {
            "description": "unauthorized"
          }
        },
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/external_processing_deposits_create_parameter_body_schema"
              }
            }
          }
        }
      }
    },
    "/api/v1/external_processing/payments/withdrawals": {
      "post": {
        "summary": "Создание вывода средств с внешним процессингом",
        "tags": [
          "Платежи с внешним процессингом"
        ],
        "security": [
          {
            "bearerAuth": {
            }
          }
        ],
        "parameters": [

        ],
        "responses": {
          "201": {
            "description": "успешное создание",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "id": "171478a9-3f58-4149-949b-2e3508ee7495",
                    "type": "Withdrawal",
                    "attributes": {
                      "uuid": "171478a9-3f58-4149-949b-2e3508ee7495"
                    }
                  }
                },
                "schema": {
                  "$ref": "#/components/schemas/external_processing_withdrawals_create_response_body_schema"
                }
              }
            }
          },
          "422": {
            "description": "invalid",
            "content": {
              "application/json": {
                "example": {
                  "errors": [
                    {
                      "title": "card_number",
                      "detail": "не указан",
                      "code": 422
                    }
                  ]
                }
              }
            }
          },
          "401": {
            "description": "unauthorized"
          }
        },
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/external_processing_withdrawals_create_parameter_body_schema"
              }
            }
          }
        }
      }
    },
    "/api/v1/payments/deposits": {
      "post": {
        "summary": "Создание депозита",
        "tags": [
          "Платежи"
        ],
        "security": [
          {
            "bearerAuth": {
            }
          }
        ],
        "description": "## Создание депозита\n\nДля отправки запроса нужно сформировать тело (Request body) в формате JSON со следующими параметрами:\n\n| Параметр                   | Название                    | Тип    | Наличие     | Описание                                                                                       |\n|----------------------------|-----------------------------|--------|-------------|------------------------------------------------------------------------------------------------|\n| `national_currency`        | Национальная валюта         | String | Обязательно | Укажите валюту, в которой клиент будет вносить деньги                                          |\n| `national_currency_amount` | Сумма                       | Number | Обязательно | Укажите сумму платежа                                                                          |\n| `external_order_id`        | Внешний ID заявки           | String | Опционально | Укажите ID платежа или заявки в Вашей системе, чтобы можно было по нему отследить платёж у нас |\n| `redirect_url`             | Ссылка на возврат в магазин | String | Обязательно | Укажите ссылку, по которой клиент вернётся в магазин в конце оплаты                            |\n| `callback_url`             | Ссылка обратного вызова     | String | Обязательно | Укажите Вашу ссылку обратного вызова, для POST запросов об изменениях статуса                  |\n\n<br>\n\n## Ссылка обратного вызова (callback_url)\n\nСервис создания депозита будет информировать Вас об изменениях статуса платежа с\nпомощью ссылки callback_url. По ней будет отправляться серия POST запросов (при\nкаждом изменении статуса) со следующей информацией.\n\n### В заголовках (headers):\n\n| Заголовок                              | Описание                                                               |\n|----------------------------------------|------------------------------------------------------------------------|\n| `Content-Type: application/json`       | Тело запроса содержит JSON объект                                      |\n| `Authorization: Bearer {Ваш API-ключ}` | Ваш API ключ, для удостоверения того что запрос пришёл с нашей стороны |\n\n<br>\n\n### В теле запроса в формате JSON:\n\n<table>\n  <thead>\n    <tr>\n      <th>Параметр</th>\n      <th>Название</th>\n      <th>Тип</th>\n      <th>Наличие</th>\n      <th>Описание</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td><code>uuid</code></td>\n      <td>Идентификатор платежа</td>\n      <td>String</td>\n      <td>Обязательно</td>\n      <td>Универсальный уникальный идентификатор платежа</td>\n    </tr>\n    <tr>\n      <td><code>extenal_order_id</code></td>\n      <td>Внешний ID заявки</td>\n      <td>String</td>\n      <td>Опционально</td>\n      <td>ID платежа в Вашей системе</td>\n    </tr>\n    <tr>\n      <td><code>payment_status</code></td>\n      <td>Статус платежа</td>\n      <td>String</td>\n      <td>Обязательно</td>\n      <td>\n        Статус платежа. Может иметь следующие значения:\n        <ul>\n          <li><strong>draft</strong> — Ввод данных карты</li>\n          <li><strong>processer_search</strong> — Поиск оператора</li>\n          <li><strong>transferring</strong> — Перевод денег</li>\n          <li><strong>confirming</strong> — Подтверждение перевода</li>\n          <li><strong>completed</strong> — Успешно завершён</li>\n          <li><strong>cancelled</strong> — Отменён</li>\n        </ul>\n      </td>\n    </tr>\n  </tbody>\n</table>\n\n#### Пример приходящего по callback_url запроса:\n\n```\n{\n  \"data\": {\n    \"id\": \"191\",\n    \"type\": \"Deposit\",\n    \"attributes\": {\n      \"uuid\": \"8de5d972-cdbb-48c1-9afe-318c38247fa7\",\n      \"external_order_id\": \"1234\",\n      \"payment_status\": \"confirming\"\n    }\n  }\n}\n```\n\n<br>\n\n*Для отправки тестового запроса, нажмите кнопку `Try it out`, затем внизу `Execute`*\n\n*Предварительно можно открыть в браузере `Dev Tools (F12)` > вкладка `Network`, чтобы увидеть все данные по запросу.*\n",
        "parameters": [

        ],
        "responses": {
          "201": {
            "description": "успешное создание",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "id": "6321eb0e-ee0e-4b4d-b9a1-5c142a21d3f8",
                    "type": "Deposit",
                    "attributes": {
                      "uuid": "6321eb0e-ee0e-4b4d-b9a1-5c142a21d3f8",
                      "url": "http://example.org/payments/deposits/6321eb0e-ee0e-4b4d-b9a1-5c142a21d3f8?signature=86d65b0b781d4c5e60e7bebec1fb98e38e217f313051fadfd1bf84058f6d2222"
                    }
                  }
                },
                "schema": {
                  "$ref": "#/components/schemas/payments_create_response_body_schema"
                }
              }
            }
          },
          "422": {
            "description": "invalid",
            "content": {
              "application/json": {
                "example": {
                  "errors": [
                    {
                      "title": "national_currency",
                      "detail": "Доступные значения RUB, UZS, TJS, IDR",
                      "code": 422
                    }
                  ]
                }
              }
            }
          },
          "401": {
            "description": "unauthorized"
          }
        },
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/payments_create_parameter_body_schema"
              }
            }
          }
        }
      }
    },
    "/api/v1/payments/{uuid}/statuses/{event}": {
      "patch": {
        "summary": "Обновление статуса платежа с внешним процессингом",
        "tags": [
          "Платежи с внешним процессингом"
        ],
        "security": [
          {
            "bearerAuth": {
            }
          }
        ],
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "event",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "on allowed event"
          },
          "422": {
            "description": "on merchant requires image"
          },
          "400": {
            "description": "on internal processing type"
          },
          "404": {
            "description": "does not found with unauthorized payment access"
          },
          "401": {
            "description": "unauthorized on invalid token"
          }
        }
      }
    },
    "/api/v1/payments/withdrawals": {
      "post": {
        "summary": "Создание вывода средств",
        "tags": [
          "Платежи"
        ],
        "security": [
          {
            "bearerAuth": {
            }
          }
        ],
        "description": "## Создание вывода средств\n\nДля отправки запроса нужно сформировать тело (Request body) в формате JSON со следующими параметрами:\n\n| Параметр                   | Название                    | Тип    | Наличие     | Описание                                                                                       |\n|----------------------------|-----------------------------|--------|-------------|------------------------------------------------------------------------------------------------|\n| `national_currency`        | Национальная валюта         | String | Обязательно | Укажите валюту, в которой клиент хочет получить деньги                                         |\n| `national_currency_amount` | Сумма                       | Number | Обязательно | Укажите сумму платежа                                                                          |\n| `external_order_id`        | Внешний ID заявки           | String | Опционально | Укажите ID платежа или заявки в Вашей системе, чтобы можно было по нему отследить платёж у нас |\n| `redirect_url`             | Ссылка на возврат в магазин | String | Обязательно | Укажите ссылку, по которой клиент вернётся в магазин в конце оплаты                            |\n| `callback_url`             | Ссылка обратного вызова     | String | Обязательно | Укажите Вашу ссылку обратного вызова, для POST запросов об изменениях статуса                  |\n\n<br>\n\n## Ссылка обратного вызова (callback_url)\n\nСервис создания вывода средств будет информировать Вас об изменениях статуса платежа с\nпомощью ссылки callback_url. По ней будет отправляться серия POST запросов (при\nкаждом изменении статуса) со следующей информацией.\n\n### В заголовках (headers):\n\n| Заголовок                              | Описание                                                               |\n|----------------------------------------|------------------------------------------------------------------------|\n| `Content-Type: application/json`       | Тело запроса содержит JSON объект                                      |\n| `Authorization: Bearer {Ваш API-ключ}` | Ваш API ключ, для удостоверения того что запрос пришёл с нашей стороны |\n\n<br>\n\n### В теле запроса в формате JSON:\n\n<table>\n  <thead>\n    <tr>\n      <th>Параметр</th>\n      <th>Название</th>\n      <th>Тип</th>\n      <th>Наличие</th>\n      <th>Описание</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td><code>uuid</code></td>\n      <td>Идентификатор платежа</td>\n      <td>String</td>\n      <td>Обязательно</td>\n      <td>Универсальный уникальный идентификатор платежа</td>\n    </tr>\n    <tr>\n      <td><code>extenal_order_id</code></td>\n      <td>Внешний ID заявки</td>\n      <td>String</td>\n      <td>Опционально</td>\n      <td>ID платежа в Вашей системе</td>\n    </tr>\n    <tr>\n      <td><code>payment_status</code></td>\n      <td>Статус платежа</td>\n      <td>String</td>\n      <td>Обязательно</td>\n      <td>\n        Статус платежа. Может иметь следующие значения:\n        <ul>\n          <li><strong>draft</strong> — Ввод данных карты</li>\n          <li><strong>processer_search</strong> — Поиск оператора</li>\n          <li><strong>transferring</strong> — Перевод денег</li>\n          <li><strong>confirming</strong> — Подтверждение перевода</li>\n          <li><strong>completed</strong> — Успешно завершён</li>\n          <li><strong>cancelled</strong> — Отменён</li>\n        </ul>\n      </td>\n    </tr>\n  </tbody>\n</table>\n\n#### Пример приходящего по callback_url запроса:\n\n```\n{\n  \"data\": {\n    \"id\": \"191\",\n    \"type\": \"Deposit\",\n    \"attributes\": {\n      \"uuid\": \"8de5d972-cdbb-48c1-9afe-318c38247fa7\",\n      \"external_order_id\": \"1234\",\n      \"payment_status\": \"confirming\"\n    }\n  }\n}\n```\n\n<br>\n\n*Для отправки тестового запроса, нажмите кнопку `Try it out`, затем внизу `Execute`*\n\n*Предварительно можно открыть в браузере `Dev Tools (F12)` > вкладка `Network`, чтобы увидеть все данные по запросу.*\n",
        "parameters": [

        ],
        "responses": {
          "201": {
            "description": "успешное создание",
            "content": {
              "application/json": {
                "example": {
                  "data": {
                    "id": "94da9773-1024-4e80-afc2-3652fa87bf77",
                    "type": "Withdrawal",
                    "attributes": {
                      "uuid": "94da9773-1024-4e80-afc2-3652fa87bf77",
                      "url": "http://example.org/payments/withdrawals/94da9773-1024-4e80-afc2-3652fa87bf77?signature=95b321ee9ca330dd65f6f4ff60392f03e69af9a9011f0c198d26e98b50367771"
                    }
                  }
                },
                "schema": {
                  "$ref": "#/components/schemas/payments_create_response_body_schema"
                }
              }
            }
          },
          "422": {
            "description": "invalid",
            "content": {
              "application/json": {
                "example": {
                  "errors": [
                    {
                      "title": "national_currency",
                      "detail": "Доступные значения RUB, UZS, TJS, IDR",
                      "code": 422
                    }
                  ]
                }
              }
            }
          },
          "401": {
            "description": "unauthorized"
          }
        },
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/payments_create_parameter_body_schema"
              }
            }
          }
        }
      }
    },
    "/api/v1/payments/{uuid}": {
      "get": {
        "summary": "Получение информации по платежу",
        "tags": [
          "Платежи"
        ],
        "security": [
          {
            "bearerAuth": {
            }
          }
        ],
        "description": "## Получение информации по платежу\n\nДля отправки запроса нужно добавить uuid платежа в строку GET-запроса `/api/v1/payments/{uuid}`.\n\n<br>\n\n*Для отправки тестового запроса, нажмите кнопку `Try it out`, введите __uuid__ платежа, затем внизу `Execute`*\n\n*Предварительно можно открыть в браузере `Dev Tools (F12)` > вкладка `Network`, чтобы увидеть все данные по запросу.*\n",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "payment with uuid is present",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/payments_show_response_body_schema"
                }
              }
            }
          },
          "404": {
            "description": "does not found with unauthorized payment access"
          },
          "401": {
            "description": "unauthorized on invalid token"
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer"
      }
    },
    "schemas": {
      "external_processing_deposits_create_parameter_body_schema": {
        "type": "object",
        "properties": {
          "payment_system": {
            "type": "string",
            "example": "Sberbank"
          },
          "national_currency": {
            "type": "string",
            "example": "RUB"
          },
          "national_currency_amount": {
            "type": "number",
            "example": 3000.0
          },
          "external_order_id": {
            "type": "string",
            "example": "1234"
          },
          "callback_url": {
            "type": "string",
            "example": "https://example.com/callback_url"
          }
        }
      },
      "external_processing_withdrawals_create_parameter_body_schema": {
        "type": "object",
        "properties": {
          "payment_system": {
            "type": "string",
            "example": "Sberbank"
          },
          "card_number": {
            "type": "string",
            "example": "1234 5678 9012 3456"
          },
          "national_currency": {
            "type": "string",
            "example": "RUB"
          },
          "national_currency_amount": {
            "type": "number",
            "example": 3000.0
          },
          "external_order_id": {
            "type": "string",
            "example": "1234"
          },
          "callback_url": {
            "type": "string",
            "example": "https://example.com/callback_url"
          }
        }
      },
      "external_processing_deposits_create_response_body_schema": {
        "type": "object",
        "properties": {
          "data": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string"
              },
              "type": {
                "type": "string"
              },
              "attributes": {
                "type": "object",
                "properties": {
                  "uuid": {
                    "type": "string"
                  },
                  "card_number": {
                    "type": "string"
                  },
                  "expiration_time": {
                    "type": "string"
                  }
                },
                "required": [
                  "uuid",
                  "card_number",
                  "expiration_time"
                ]
              }
            },
            "required": [
              "id",
              "type",
              "attributes"
            ]
          }
        },
        "required": [
          "data"
        ]
      },
      "external_processing_withdrawals_create_response_body_schema": {
        "type": "object",
        "properties": {
          "data": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string"
              },
              "type": {
                "type": "string"
              },
              "attributes": {
                "type": "object",
                "properties": {
                  "uuid": {
                    "type": "string"
                  }
                },
                "required": [
                  "uuid"
                ]
              }
            },
            "required": [
              "id",
              "type",
              "attributes"
            ]
          }
        },
        "required": [
          "data"
        ]
      },
      "payments_create_parameter_body_schema": {
        "type": "object",
        "properties": {
          "national_currency": {
            "type": "string",
            "example": "RUB"
          },
          "national_currency_amount": {
            "type": "number",
            "example": 3000.0
          },
          "external_order_id": {
            "type": "string",
            "example": "1234"
          },
          "redirect_url": {
            "type": "string",
            "example": "https://example.com/redirect_url"
          },
          "callback_url": {
            "type": "string",
            "example": "https://example.com/callback_url"
          }
        }
      },
      "payments_create_response_body_schema": {
        "type": "object",
        "properties": {
          "data": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string"
              },
              "type": {
                "type": "string"
              },
              "attributes": {
                "type": "object",
                "properties": {
                  "uuid": {
                    "type": "string"
                  },
                  "url": {
                    "type": "string"
                  }
                },
                "required": [
                  "uuid",
                  "url"
                ]
              }
            },
            "required": [
              "id",
              "type",
              "attributes"
            ]
          }
        },
        "required": [
          "data"
        ]
      },
      "payments_show_response_body_schema": {
        "type": "object",
        "properties": {
          "data": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string"
              },
              "type": {
                "type": "string"
              },
              "attributes": {
                "type": "object",
                "properties": {
                  "uuid": {
                    "type": "string",
                    "example": "c6b025f5-d938-4274-ba72-ae057c5f58dd"
                  },
                  "external_order_id": {
                    "type": "string",
                    "example": "1234"
                  },
                  "created_at": {
                    "type": "string",
                    "example": "2023-02-24T10:47:05.281+03:00"
                  },
                  "national_currency": {
                    "type": "string",
                    "example": "RUB"
                  },
                  "national_currency_amount": {
                    "type": "string",
                    "example": "3000.0"
                  },
                  "cryptocurrency": {
                    "type": "string",
                    "example": "USDT"
                  },
                  "payment_system": {
                    "type": "string",
                    "example": "Sberbank"
                  },
                  "payment_status": {
                    "type": "string",
                    "example": "completed"
                  }
                },
                "required": [
                  "uuid",
                  "created_at",
                  "national_currency",
                  "national_currency_amount",
                  "cryptocurrency",
                  "payment_system",
                  "payment_status"
                ]
              }
            },
            "required": [
              "id",
              "type",
              "attributes"
            ]
          }
        },
        "required": [
          "data"
        ]
      }
    }
  },
  "security": {
    "bearerAuth": [

    ]
  }
}